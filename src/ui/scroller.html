<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="../../../jquery.js"></script>
    <script type="text/javascript" src="http://js.tgimg.cn/lib/jquery/tgui/2.0.js"></script>
    <style>
        .scroller-box {
            height: 100px;
            padding: 0 25px;
            width: 500px;
            position: relative;
        }
        .scroller-box .btn-next,.scroller-box .btn-prev {
            background: url("http://img.tgimg.cn/wenda/question/index.png");
            position: absolute;
            width: 25px;
            height: 35px;
            margin-top: 40px;
            opacity: .6;
            filter: alpha(Opacity=60);
            cursor: pointer;
        }
        .scroller-box .btn-next {
            left: 0;
        }
        .scroller-box .btn-prev {
            right: 0;
        }
        .scroller {
            width: 500px;
            overflow-x: hidden;
        }
        .scroller ul {
            width: 9999px;
        }
        ul,li {
            list-style: none;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        li {
            width: 100px;
            height: 100px;
            float: left;
        }
    </style>
</head>
<body>
    <div class="scroller-box">
        <div class="scroller">
            <ul>
                <li style="background-color: #ddd">1</li>
                <li style="background-color: red">2</li>
                <li style="background-color: yellow">3</li>
                <li style="background-color: blue">4</li>
                <li style="background-color: green">5</li>
                <li style="background-color: yellow">6</li>
            </ul>
        </div>
    </div>
    <script>
        (function ($) {
            var Carousel = function(obj,options) {
                if (!(this instanceof Carousel)) return new Carousel(obj, options);
                this.options = $.extend({}, arguments.callee.defaults);
                this.$element = $(obj);
                if (!this.$element) {
                    console.log('请绑定一个对象');
                } else {
                    this.$btnPrev = $('<a class="btn-prev"></a>');
                    this.$btnNext = $('<a class="btn-next"></a>');
                    this.current = this.options.current ? this.options.current : 1;
                    this.liWidth = 0;
                    this.minLeft = 0;
                    this.initLeft = 0;
                    this.$lis;
                    this.timer;
                    this._init();
                }
            }

            Carousel.prototype = {
                constructor: Carousel,
                _init: function() {
                    var $self = this,
                        $ul = $self.$element.find('ul'),
                        $lis = $ul.find('li'),
                        liLength = $lis.length,
                        liWidth = $lis.outerWidth(true),
                        minLenght = Math.ceil($('.scroller',$self.$element).width() / liWidth);
                    $self.liWidth = liWidth;
                    $self.$lis = $lis;
                    if (liLength > minLenght) {
                        var html = $ul.html(),
                        initLeft = -liWidth * liLength,
                        minLeft = initLeft * 2;
                        $ul.html(html + html + html);
                        $ul.css("margin-left", initLeft - $self.options.index * liWidth);
                        $self.minLeft = minLeft;
                        $self.initLeft = initLeft;
                        $self.autoMove();
                        //移上停止滚动
                        var $btnNext = $self.$btnNext;
                        var $btnPrev = $self.$btnPrev;
                        $self.$element.hover(function() {
                            $self.stop();
                            $self.$element.prepend($btnNext);
                            $self.$element.prepend($btnPrev);
                        },function() {
                            $self.start();
                            $btnNext = $btnNext.detach();
                            $btnPrev = $btnPrev.detach();
                        });
                        //点击某个选卡
                        $ul.find('li').each(function(index) {
                            var $that = $(this);
                            $that.on('click',function() {
                                var quotient = (index + 1) / liLength;
                                var remainder = index % liLength
                                /*if (!$self.options.direction) { //向右

                                } else {                        //向左
                                   if (quotient > 2) {
                                        $ul.css('margin-left', '+=' + liLength * liWidth);
                                    }
                                }*/
                                $self.go2scene(remainder);
                            })
                        })
                        //点击上一个和下一个按钮
                        $self.btnBindEvent();

                    }
                },
                btnBindEvent: function() {
                    var $self = this;
                    $self.$btnNext.on('click',function() {
                        $self.options.direction = 0;
                        $self.stepMove();
                    })
                    $self.$btnPrev.on('click',function() {
                        $self.options.direction = 1;
                        $self.stepMove();
                    })

                },
                go2scene: function(index) {
                    var $self = this,
                        $ul = $self.$element.find('ul');
                    $ul.stop(true,true);
                    if (index >= 0 && index <= $self.$lis.length) {
                        $ul.trigger('switch-before',index);
                        $ul.animate({
                            "margin-left": - (index + $self.$lis.length) * $self.liWidth
                        },$self.options.interval,function() {
                            $ul.trigger('switch-finish',index);
                        })
                        $self.options.index = index;
                    } else {
                        alert('超出滚动范围')
                    }
                },
                resetPosition: function($ul) {
                    var $self = this;
                    var left = parseInt($ul.css("margin-left"));
                    if (left <= $self.minLeft || left >= 0) {
                        $ul.css("margin-left", $self.initLeft);
                        $self.options.index = 0;
                    } else {
                        $self.options.index += 1;
                    }
                },
                stepMove: function() {
                    var $self = this;
                    var $ul = $self.$element.find('ul');
                    $self.resetPosition($ul);
                    $ul.trigger('switch-before',$self.options.index);
                    $ul.animate({ "margin-left": ($self.options.direction ? '-' : '+') + "=" + $self.liWidth },$self.options.interval,function() {
                        $ul.trigger('switch-finish',$self.options.index);
                    });
                },
                autoMove: function() {
                    var $self = this;
                    var $ul = $self.$element.find('ul');
                    $self.timer = setInterval(function() {
                        $ul.stop(true, true);
                        $self.stepMove();
                    },$self.options.interval);
                },
                stop: function() {
                    var $self = this;
                    $self.$element.find('ul').stop(true, true);
                    clearInterval($self.timer);
                },
                start: function() {
                    var $self = this;
                    if (!!$self.timer) {
                        clearInterval($self.timer);
                    }
                    this.autoMove();
                }
            }

            Carousel.defaults = {
                direction: 1, //默认方向
                interval: 2000, //默认滚动时间
                index: 0          //默认初始化显示第一个选卡
            }
            $.fn.carousel = function(options) {
                var $self = this,
                    carousel = $self.data('carousel');
                if (!!carousel) {
                    return carousel;
                } else {
                    $self.data('carousel',Carousel($self,options));
                    return this;
                }
            }
            //$.UI.Scroller = Carousel;
        })(jQuery);
        var $scroll = $('.scroller-box').carousel();
        /*$('.scroller-box').find('ul').on('switch-before',function() {
            console.log('move-before')
        });
        $('.scroller-box').find('ul').on('switch-finish',function() {
            console.log('move-finish')
        });*/
    </script>
    <script>
        /*(function(){
         var $panes = $('.pic-show-panes');
         var $tabs = $('.pic-show-tabs ul');
         var t, i = 0, d = false, step = 1, length, size, liWidth;
         function start(fn, delay) {
         t = setInterval(fn, delay);
         }
         function stop() {
         clearTimeout(t);
         }
         function resume(){
         $tabs.trigger('carouselswitch', i);
         $tabs.css('margin-left', (i + length) * -liWidth);
         }
         function next(d) {
         var move = (!d ? step : -step) + i;
         scroll(move, 500);
         i = move >= length ? move - length : move < 0 ? move + length : move;
         }
         function scroll (move, duration) {
         $tabs.finish().animate({
         'margin-left': (move + length) * -liWidth
         }, duration, resume);
         }
         function show(_, i) {
         var $i = $li.eq(i);
         $panes.children().eq(0).hide(300, function(){
         $(this).remove();
         });
         $('<a href="' + $i.data('href') + '" style="display: none" target="_blank"><img src="' + $i.data('thumbnail') + '"/></a>').appendTo($panes).show(300);
         $('.case-idea').find('dd').html($i.data('content')).end().find('dt').html($i.attr('title'));
         }
         var $li = $('li', '.pic-show-tabs').each(function(index, item){
         $('a', item).click(function(){
         if (size < length) {
         scroll(index < i ? index + length : index, 500);
         } else {
         $tabs.trigger('carouselswitch', index);
         }
         i = index;
         return false;
         })
         });
         $tabs.on('carouselswitch', show)
         liWidth = $li.outerWidth(true);
         length = $li.length;
         size = Math.ceil($('.pic-show-tabs').width() / liWidth);
         if (size < length) {
         $li.clone(true).appendTo($tabs).clone(true).prependTo($tabs);
         resume()
         $tabs.on('mouseenter', function(){
         stop();
         }).on('mouseleave', function(){
         start(function(){next(d)}, 5000);
         }).trigger('mouseleave');

         }
         show(null, i);
         })()*/
        /*var timer0 = TG.Timer(2000,2);
        timer0.bind(function() {
            console.log('timer0:' + 1)
        })*/
        var timer1 = TG.Timer(4000);
        timer1.bind(function() {
            console.log('timer1:' + 2.0)
        })
        timer1.bind(function() {
            console.log('timer1:' + 2.1)
        })
        /*timer0.start()*/
        //timer1.start()
    </script>
</body>
</html>